<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:h="http://xmlns.jcp.org/jsf/html" 
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
    <h:head>
        <meta charset="UTF-8"></meta>
        <title>SysContable</title>
        <link rel="icon" type="image/jpg" href="./resources/imagenes/img.jpg"></link>
        <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
        <link href="./resources/css/style.css" rel="stylesheet" type="text/css"/>

        <script>
            var inactivityTimeout = null;
            var maxInactivityTime = 60000; // 1 minuto (en milisegundos)

            function resetInactivityTimer() {
                clearTimeout(inactivityTimeout);
                inactivityTimeout = setTimeout(logoutAndRedirect, maxInactivityTime);
            }

            function logoutAndRedirect() {
                // Realiza una solicitud AJAX al servidor para cerrar la sesión
                fetch('/logout', {
                    method: 'POST',
                    credentials: 'same-origin'  // Incluye las credenciales de sesión en la solicitud
                })
                        .then(response => {
                            // Redirige al usuario a la página de inicio de sesión después de cerrar la sesión
                            window.location.href = 'login.xhtml';
                        })
                        .catch(error => console.error('Error:', error));
            }

            // Función para deshabilitar los botones de navegación del navegador
            function disableBrowserNavigation() {
                window.history.pushState(null, '', window.location.href);
                window.onpopstate = function () {
                    window.history.pushState(null, '', window.location.href);
                };
            }

            // Inicia la función para deshabilitar la navegación del navegador al cargar la página
            window.onload = function () {
                disableBrowserNavigation();
                resetInactivityTimer(); // Inicia el temporizador de inactividad
            };

            // Reiniciar el temporizador de inactividad en caso de interacción del usuario
            document.addEventListener('click', resetInactivityTimer);
            document.addEventListener('mousemove', resetInactivityTimer);
            document.addEventListener('keypress', resetInactivityTimer);
        </script>

    </h:head>
    <h:body>
        <ui:include src="menu.xhtml" />
    </h:body>
</html>

